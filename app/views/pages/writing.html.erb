<% @size = 8 %>
<% year = 0 %>

<div class="container">
  <!-- post -->
  <% if @post != nil %>
    <%= render 'post', locals: { size: @size } %> 
  <!-- otherwise -->
  <% else %>
  <!-- intro -->
  <div class="row justify-content-center">
    <div class="col-12 col-lg-<%= @size %> text-center">
      <p class="mb-0">A collection of writings on various topics.</p>
    </div>
  </div>
  <!-- writing -->
  <div class="row justify-content-center mt-5">
    <div class="col-12 col-lg-<%= @size %>">
      <div class="row list">
        <% @dir_posts.each do |post| %>
        <% if post[:date].last(4) != year %>
        <% year = post[:date].last(4) %>
        <!-- year -->
        <li class="col-12 text-center">
          <p class="font-weight-bold <% if @dir_posts.first != post %>my-3<% else %>mb-3<% end %>"><%= year %></p>
        </li>
        <% end %>
        <!-- post:meta -->
        <li class="list-item no-bullet col-12">
          <!-- post:date -->
          <!-- <p class="text-small text-muted mb-0">
            <%= Date.parse(post[:date]).strftime("%b -%d, %Y").gsub("-0", "").gsub("-", "") %>
          </p> -->
          <!-- post:title -->
          <p>
            <a href="/<%= @route_path %>/<%= post[:filename] %>" data-turbolinks="true">
              <%= post[:title] %>
            </a>
          </p>
        </li>
        <% end %>
      </div>
      <!-- OLD BELOW THIS LINE -->
      <% if false %>
        <!-- tag -->
        <% if @tag %>
          <p class="p-3 border-solid--grey mt-4 mb-0">
            Posts in: <a href="/writing/<%= @tag %>" class="px-3"></i> <%= @tag.gsub("-", " ").titleize %></a>
            <!-- clear tags -->
            <a href="/writing" class="float-right">Clear</a>
          </p>
        <% elsif @tags_all %>
          <!-- links with all tags -->
          <p class="p-3 text-center border-solid--grey mt-4 mb-0">
            <% @tags_all.each do |tag| %>
            <!-- replace space with - -->
            <a href="/writing/<%= tag %>" class="px-3"><%= tag.gsub("-", " ").titleize %></a>
            <% end %>
          </p>
        <% end %>
        <!-- list all posts -->
        <div class="row list">
          <% if @posts_array %>
          <% @year = 0 %>
          <% @posts_array.keys.each do |post| %>
            <% if !@posts_array[post][:draft] %>
              <!-- write year from date and put posts per year -->
              <% if @posts_array[post][:date][0..3] != @year %>
                <% @year = @posts_array[post][:date][0..3] %>
                <!-- year -->
                <!-- <div class="col-12">
                  <p class="text-muted font-family-serif mb-3"><%= @year %></p>
                </div> -->
                <li class="list_header col-12">
                  <p class="background--grey my-3 px-3 py-2"><%= @year %></p>
                </li>
              <% end %>
              <!-- item -->
              <li class="list-item no-bullet col-12 mb-3">
                <!-- post:date -->
                <p class="text-muted font-family-serif mb-0">
                  <% if @posts_array[post][:draft] %>
                    <span class="text-muted">DRAFT</span>
                  <% else %>
                    <%= Date.parse(@posts_array[post][:date]).strftime("%b -%d, %Y").gsub("-0", "").gsub("-", "") %>
                  <% end %>
                </p>
                <!-- post:title -->
                <h3 class="font-family-serif font-weight-bold pb-0">
                  <% if @posts_array[post][:draft] %>
                  <a href="https://github.com/miqqeio/michaelsjoeberg.com/blob/main/public/posts/<%= post %>.md" data-turbolinks="true" class="text-muted" target="_blank">
                    <%= @posts_array[post][:title] %>
                  </a>
                  <% else %>
                  <a href="/<%= @route_path %>/<%= post %>" data-turbolinks="true" class="<% if @posts_array[post][:draft] %>text-muted<% end %>">
                    <%= @posts_array[post][:title] %>
                  </a>
                  <% end %>
                </h3>
              </li>
            <% end %>
          <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
  <% end %>
</div>
